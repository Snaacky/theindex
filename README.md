[![Website](https://img.shields.io/website?down_message=offline&label=piracy.moe&up_message=online&url=https%3A%2F%2Fpiracy.moe&logo=data:image/png;base64,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)](https://piracy.moe)
[![GitHub Workflow Status](https://img.shields.io/github/workflow/status/ranimepiracy/index/Docker?logo=github)](https://github.com/ranimepiracy/index)
[![CodeFactor](https://www.codefactor.io/repository/github/ranimepiracy/index/badge)](https://www.codefactor.io/repository/github/ranimepiracy/index)
[![Codacy Badge](https://app.codacy.com/project/badge/Grade/841b254fc40146108ca99d32ce833199)](https://www.codacy.com/gh/ranimepiracy/index/dashboard)
[![Docker Image Size (tag)](https://img.shields.io/docker/image-size/ranimepiracy/index/latest?logo=docker)](https://hub.docker.com/r/ranimepiracy/index)
[![Subreddit subscribers](https://img.shields.io/reddit/subreddit-subscribers/animepiracy?label=%2Fr%2Fanimepiracy&logo=reddit)](https://www.reddit.com/r/animepiracy)
[![Twitter Follow](https://img.shields.io/twitter/follow/ranimepiracy?label=%40ranimepiracy&logo=twitter&style=flat)](https://twitter.com/ranimepiracy)
[![Discord](https://img.shields.io/discord/622243127435984927?label=Discord&logo=discord)](https://discord.gg/piracy)

# [piracy.moe](https://piracy.moe) index

This repository is the web-ui of /r/animepiracy index.

If you want to just report missing or false data, please go over to our [Discord](https://discord.gg/piracy) and report
it in `#index`.

## Getting started

The easiest way is to use docker via:

```shell
docker run -d -p <host-port>:8080 -v /path/on/host:/config --name=index ranimepiracy/index
```

You'll need to change `<host-port>` to your port of choice. The web-server is not secured via SSL/TLS, it is in your
responsibility to put a reverse proxy in front of this container. After starting the container you can add your own
[discord-id](https://discord.com/developers/docs/resources/user) to the file `/config/whitelist.json` to be able to
login and edit.

## Updating container image

To get the newest version of image from [docker-hub](https://hub.docker.com/repository/docker/ranimepiracy/index), you
will need to run:

```shell
docker pull ranimepiracy/index
```

Afterwards you will need to stop and remove your current running instance and start it again.

## Parameters

Here is a table of the possible ENV-variables with their default values.

| Parameter | Function |
| :----: | --- |
| `-e AUDIT_WEBHOOK=""` | Webhook-URL for audit-log |
| `-e DISCORD_CLIENT_ID=00000000000` | Discord client ID |
| `-e DISCORD_CLIENT_SECRET="your_discord_client_secret"` | Discord client secret |
| `-e DISCORD_REDIRECT_URI="https://piracy.moe/user/callback/"` | OAuth-2 callback for discord |
| `-e DISCORD_BOT_TOKEN="your_discord_bot_token"` | Required to access BOT resources |
| `-e DB_CONNECTION_URI="mysql+pymysql://user:password@hostname/database"` | Required for external database |

## Getting started to code

### Backend

We highly encourage you to use [Docker](https://get.docker.com) to run the backend, as the setup of the run environment
would require a lot of work. To build the [docker image](https://docs.docker.com/engine/reference/commandline/build/)
you will need to run:

```shell
docker build -f Docker-api-only -t index
```

Afterwards you will just need to run

```shell
docker run -p 8080:8080 index
```

You can now open http://localhost:8080 in your browser to see a running version of the backend server. If you don't want
the console to continue running in the foreground, add the `-d` argument to the run command.

The source of the backend api can be found at [/api](api). The script /api/init.py will only be run if no existing
database is found. The [Flask](https://github.com/pallets/flask) server itself will be generated
at [/api/app.py](api/app.py).

We use blueprints to register all http endpoints:

- [/api/queries.py](api/queries.py) defines the public api endpoints, a.k.a. the fetch only stuff with
  `Access-Control-Allow-Origin` set to `*`

- [/api/mutations.py](api/mutations.py) creates the edit endpoints for modifying existing data

- [/api/user.py](api/user.py) handles the user management, e.g. login/logout

The data models are defined in [/api/models.py](api/models.py).

### Frontend

To start coding on the frontend, you will need to make sure, you have
[node.js](https://nodejs.org/en/https://nodejs.org/en/) correctly installed. To install all the required dependencies
run once:

```shell
npm install
```

You should now have a folder called `node_modules`, which contains all the dependencies we need. We use
[React](https://reactjs.org) as framework with [TypeScript](https://www.typescriptlang.org) as language. To test the
frontend you will have to run the backend api server in the background and start the frontend via:

```shell
npm start
```

After compiling your browser should open the running frontend automatically, you may need to manually copy the url shown
in the console, depending on your IDE of choice.

As we use [React](https://reactjs.org), the frontend supports hot reloading, so you can just leave the page open, while
you modify the code in [/src](src) and see the changes on the fly in your browser.

## Building everything

To create a ready-made docker image with frontend and backend together, just run:

```shell
docker build . -t index
```

You now have a local image with tag `index` that contains the build, minified distribution version of the code.

## Contribution

Pull-requests are always welcome, but may not be always merged as it has to be in align with our idea of the index. If
you want a certain feature or have an idea, you can always open a feature request
in [Issues](https://github.com/ranimepiracy/index/issues/new?assignees=&labels=enhancement&template=feature_request.md&title=%5BFEAT%5D)
or report it on our [Discord](https://discord.gg/piracy) in `#index` to be discussed. If it is not bad, in align with
our ideas, and we find some time, we will certainly implement your requested feature (sometime...).
